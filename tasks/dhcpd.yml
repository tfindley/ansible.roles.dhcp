---
# tasks file for rpsetup:bind


- name: DHCP - Install/Update apt package
  apt:
    name: isc-dhcp-server
  when: inventory_hostname in groups['dhcpd']


- name: DHCP - Copy in default service file
  copy:
    src: etc/default/isc-dhcp-server
    dest: /etc/default/isc-dhcp-server
    owner: root
    group: root
    mode: 0644
    directory_mode: 2755
  notify: DHCP Restart Service
  when: inventory_hostname in groups['dhcpd']


- name: DHCP - Create reservations clients list from template
  template:
    src: etc/dhcp/dhcpd.reserv.conf
    dest: /etc/dhcp/dhcpd.reserv.conf
    owner: root
    group: root
    mode: 0644
  notify: DHCP Restart Service
  when: inventory_hostname in groups['dhcpd']

- name: DHCP - Create allowed clients list from template
  template:
    src: etc/dhcp/dhcpd.allowed.conf
    dest: /etc/dhcp/dhcpd.allowed.conf
    owner: root
    group: root
    mode: 0644
  notify: DHCP Restart Service
  when: inventory_hostname in groups['dhcpd']

- name: DHCP - Create configuration from template
  template:
    src: etc/dhcp/dhcpd.conf
    dest: /etc/dhcp/dhcpd.conf
    owner: root
    group: root
    mode: 0644
  notify: DHCP Restart Service
  when: inventory_hostname in groups['dhcpd']

# You can use the following to switch DHCP functionallity between the cores - don't forget to update the handler!

- name: DHCP Disable Service on secondary
  service:
    name: isc-dhcp-server
    state: stopped
    enabled: no
  when: inventory_hostname in groups['dhcpd_secondary']

- name: DHCP Enable Service on primary
  service:
    name: isc-dhcp-server
    state: started
    enabled: yes
  when: inventory_hostname in groups['dhcpd_primary']