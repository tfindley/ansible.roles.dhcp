# ISC DHCPD configuration -- don't edit manually!
# This file is {{ ansible_managed }}.
#
ddns-update-style none;

option domain-name "{{dns_zone}}";
option domain-name-servers {% for host in groups['bind'] -%}{{ hostvars[host].ansible_default_ipv4.address }}{% if not loop.last %}{{', '}}{% else %}{{';'}}{% endif %}{%- endfor %}

default-lease-time {{dhcp_leasetime_default}};
max-lease-time {{dhcp_leasetime_max}};

# If this DHCP server is the official DHCP server for the local
# network, the authoritative directive should be uncommented.
authoritative;

# Use this to send dhcp log messages to a different log file (you also
# have to hack syslog.conf to complete the redirection).
log-facility local7;

#subnet 10.254.239.0 netmask 255.255.255.224 {
#  range 10.254.239.10 10.254.239.20;
#  option routers rtr-239-0-1.example.org, rtr-239-0-2.example.org;
#}

# This declaration allows BOOTP clients to get dynamic addresses,
# which we don't really recommend.

#subnet 10.254.239.32 netmask 255.255.255.224 {
#  range dynamic-bootp 10.254.239.40 10.254.239.60;
#  option broadcast-address 10.254.239.31;
#  option routers rtr-239-32-1.example.org;
#}

# omapi-port 7911;
# omapi-key omapi_key;

# key omapi_key {
#      algorithm hmac-md5;
#      secret AvengersAssemble==;
# }

# A slightly different configuration for an internal subnet.
subnet {{dhcp_network}} netmask {{dhcp_netmask}} {
  range {{dhcp_range_start}} {{dhcp_range_end}};
  option domain-name-servers {% for host in groups['bind'] -%}{{ hostvars[host].ansible_default_ipv4.address }}{% if not loop.last %}{{', '}}{% else %}{{';'}}{% endif %}{%- endfor %}

  option domain-name "{{dns_zone}}";
  option domain-search "{{dns_search | join(' ')}}";
  option subnet-mask {{dhcp_netmask}};
  option routers {{dhcp_gateway}};
  option broadcast-address {{dhcp_broadcast}};
  
  option ntp-servers {% for host in groups['ntp_server'] -%}{{ hostvars[host].ansible_default_ipv4.address }}{% if not loop.last %}{{', '}}{% else %}{{';'}}{% endif %}{%- endfor %}
  
  {% if pxe_server is defined %}
  filename "{{pxe_file}}";
  next-server {{pxe_server}};
  {% endif %}

  default-lease-time {{dhcp_leasetime_default}};
  max-lease-time {{dhcp_leasetime_max}};
  deny unknown-clients;
}


# All reservations stored under dhcpd.reserv.conf
include "/etc/dhcp/dhcpd.reserv.conf";
include "/etc/dhcp/dhcpd.allowed.conf";
